name: 'Alire Setup'
description: 'Install Alire package manager'
author: 'Alire Project'

inputs:
  version:
    description: Use this argument to install a stable release. Use a version number without v prefix, e.g., 1.0.1, 1.1.0. This argument will be ignored if a branch argument is supplied. Defaults to the latest stable release.
    required: false
    default: '1.2.1'
  branch:
    description: Use this argument to install a development branch (e.g., master). Using this option will require a preexisting compiler in the workflow environment.
    required: false
    default: ''
  toolchain:
    description: Arguments to pass to `alr toolchain` after setup.
    required: false
    default: 'gnat_native gprbuild'
  toolchain_dir:
    description: Location to install the toolchain under.
    required: false
    default: 'alr_install'

runs:
  using: "composite"
  steps:
    - name: Reuse cached installation
      id: cache-alr
      uses: actions/cache@v3
      path: ${{ toolchain_dir }}
      key: alr-v${{ version }}-b:${{ branch }}-t:${{ toolchain }}-d:${{ toolchain_dir }}

    - if: ${{ steps.cache-alr.outputs.cache-hit != 'true' }}
      uses: alire-project/setup-alire@v1  # v1 is the actual installer, uncached